<!DOCTYPE html>
<html lang="en" >
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Admin Task Management</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 text-gray-900">

Â  <main class="max-w-4xl mx-auto p-6">
Â  Â  <h1 class="text-3xl font-bold mb-6 text-center">ğŸ› ï¸ Manage Tasks</h1>

Â  Â  <section class="mb-8 bg-white rounded shadow p-6">
Â  Â  Â  <h2 class="text-xl font-semibold mb-4">Add / Edit Task</h2>

Â  Â  Â  <form id="taskForm" class="space-y-4 max-w-lg mx-auto">
Â  Â  Â  Â  <input type="hidden" id="taskId" value="" />

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="taskName" class="block mb-1 font-medium">Task Name</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  id="taskName"
Â  Â  Â  Â  Â  Â  placeholder="Enter task name"
Â  Â  Â  Â  Â  Â  class="w-full border rounded px-3 py-2"
Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="taskDesc" class="block mb-1 font-medium">Description</label>
Â  Â  Â  Â  Â  <textarea
Â  Â  Â  Â  Â  Â  id="taskDesc"
Â  Â  Â  Â  Â  Â  placeholder="Enter task description (optional)"
Â  Â  Â  Â  Â  Â  class="w-full border rounded px-3 py-2"
Â  Â  Â  Â  Â  Â  rows="3"
Â  Â  Â  Â  Â  ></textarea>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="taskReward" class="block mb-1 font-medium">Reward Amount (à§³)</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  Â  id="taskReward"
Â  Â  Â  Â  Â  Â  placeholder="Enter reward amount (e.g. 5)"
Â  Â  Â  Â  Â  Â  class="w-full border rounded px-3 py-2"
Â  Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  Â  step="0.01"
Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex gap-4 justify-center">
Â  Â  Â  Â  Â  <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition">
Â  Â  Â  Â  Â  Â  Save Task
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button type="button" id="resetBtn" class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500 transition">
Â  Â  Â  Â  Â  Â  Reset
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </section>

Â  Â  <section>
Â  Â  Â  <h2 class="text-xl font-semibold mb-4">All Tasks</h2>

Â  Â  Â  <div id="tasksList" class="space-y-4">
Â  Â  Â  Â  <p>Loading tasks...</p>
Â  Â  Â  </div>
Â  Â  </section>
Â  </main>

Â  <script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
Â  Â  import {
Â  Â  Â  getFirestore,
Â  Â  Â  collection,
Â  Â  Â  getDocs,
Â  Â  Â  doc,
Â  Â  Â  setDoc,
Â  Â  Â  deleteDoc,
Â  Â  Â  onSnapshot
Â  Â  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
Â  Â  import {
Â  Â  Â  getAuth,
Â  Â  Â  onAuthStateChanged
Â  Â  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
Â  Â  Â  authDomain: "bdwork-346d3.firebaseapp.com",
Â  Â  Â  projectId: "bdwork-346d3",
Â  Â  Â  storageBucket: "bdwork-346d3.appspot.com",
Â  Â  Â  messagingSenderId: "900963179093",
Â  Â  Â  appId: "1:900963179093:web:81e42d67bb31d603cc92dc",
Â  Â  Â  measurementId: "G-FM1YJ8E5GK"
Â  Â  };

Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const db = getFirestore(app);
Â  Â  const auth = getAuth(app);

Â  Â  const tasksCol = collection(db, "tasks");
Â  Â  const tasksList = document.getElementById("tasksList");
Â  Â  const taskForm = document.getElementById("taskForm");
Â  Â  const taskIdInput = document.getElementById("taskId");
Â  Â  const taskNameInput = document.getElementById("taskName");
Â  Â  const taskDescInput = document.getElementById("taskDesc");
Â  Â  const taskRewardInput = document.getElementById("taskReward");
Â  Â  const resetBtn = document.getElementById("resetBtn");

Â  Â  // Only allow access if user is admin (add your auth check here)
Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  if (!user) {
Â  Â  Â  Â  alert("Please log in first.");
Â  Â  Â  Â  window.location.href = "login.html";
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  // Here you should check user role (admin)
Â  Â  Â  // Example: get user role from Firestore and verify admin
Â  Â  Â  // For demo, skipping role check
Â  Â  Â  loadTasksRealtime();
Â  Â  });

Â  Â  // Real-time listener for tasks collection
Â  Â  function loadTasksRealtime() {
Â  Â  Â  onSnapshot(tasksCol, (snapshot) => {
Â  Â  Â  Â  if (snapshot.empty) {
Â  Â  Â  Â  Â  tasksList.innerHTML = "<p>No tasks found.</p>";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  tasksList.innerHTML = "";
Â  Â  Â  Â  snapshot.forEach(docSnap => {
Â  Â  Â  Â  Â  const task = { id: docSnap.id, ...docSnap.data() };
Â  Â  Â  Â  Â  const taskDiv = document.createElement("div");
Â  Â  Â  Â  Â  taskDiv.className = "p-4 bg-white rounded shadow flex justify-between items-center";

Â  Â  Â  Â  Â  const info = document.createElement("div");
Â  Â  Â  Â  Â  info.innerHTML = `
Â  Â  Â  Â  Â  Â  <p class="font-semibold text-lg">${task.name}</p>
Â  Â  Â  Â  Â  Â  <p class="text-gray-600">${task.description || ""}</p>
Â  Â  Â  Â  Â  Â  <p class="mt-1 font-semibold text-indigo-600">Reward: à§³${task.reward.toFixed(2)}</p>
Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  const controls = document.createElement("div");
Â  Â  Â  Â  Â  controls.className = "flex gap-3";

Â  Â  Â  Â  Â  // Edit button
Â  Â  Â  Â  Â  const editBtn = document.createElement("button");
Â  Â  Â  Â  Â  editBtn.className = "bg-yellow-400 hover:bg-yellow-500 px-3 py-1 rounded text-white";
Â  Â  Â  Â  Â  editBtn.innerHTML = `<i class="fas fa-edit"></i>`;
Â  Â  Â  Â  Â  editBtn.title = "Edit Task";
Â  Â  Â  Â  Â  editBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  taskIdInput.value = task.id;
Â  Â  Â  Â  Â  Â  taskNameInput.value = task.name;
Â  Â  Â  Â  Â  Â  taskDescInput.value = task.description || "";
Â  Â  Â  Â  Â  Â  taskRewardInput.value = task.reward;
Â  Â  Â  Â  Â  Â  window.scrollTo({ top: 0, behavior: "smooth" });
Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  // Delete button
Â  Â  Â  Â  Â  const deleteBtn = document.createElement("button");
Â  Â  Â  Â  Â  deleteBtn.className = "bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white";
Â  Â  Â  Â  Â  deleteBtn.innerHTML = `<i class="fas fa-trash"></i>`;
Â  Â  Â  Â  Â  deleteBtn.title = "Delete Task";
Â  Â  Â  Â  Â  deleteBtn.onclick = async () => {
Â  Â  Â  Â  Â  Â  if (confirm(`Delete task "${task.name}"? This action cannot be undone.`)) {
Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "tasks", task.id));
Â  Â  Â  Â  Â  Â  Â  Â  alert("Task deleted.");
Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Error deleting task: " + error.message);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  controls.appendChild(editBtn);
Â  Â  Â  Â  Â  controls.appendChild(deleteBtn);

Â  Â  Â  Â  Â  taskDiv.appendChild(info);
Â  Â  Â  Â  Â  taskDiv.appendChild(controls);

Â  Â  Â  Â  Â  tasksList.appendChild(taskDiv);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  // Reset form inputs
Â  Â  function resetForm() {
Â  Â  Â  taskIdInput.value = "";
Â  Â  Â  taskNameInput.value = "";
Â  Â  Â  taskDescInput.value = "";
Â  Â  Â  taskRewardInput.value = "";
Â  Â  }

Â  Â  resetBtn.addEventListener("click", resetForm);

Â  Â  // Handle Add/Edit form submission
Â  Â  taskForm.addEventListener("submit", async (e) => {
Â  Â  Â  e.preventDefault();

Â  Â  Â  const id = taskIdInput.value.trim();
Â  Â  Â  const name = taskNameInput.value.trim();
Â  Â  Â  const description = taskDescInput.value.trim();
Â  Â  Â  const reward = parseFloat(taskRewardInput.value);

Â  Â  Â  if (!name) return alert("Task name is required.");
Â  Â  Â  if (isNaN(reward) || reward < 0) return alert("Reward must be a valid non-negative number.");

Â  Â  Â  try {
Â  Â  Â  Â  if (id) {
Â  Â  Â  Â  Â  // Update existing task
Â  Â  Â  Â  Â  await setDoc(doc(db, "tasks", id), { name, description, reward }, { merge: true });
Â  Â  Â  Â  Â  alert("Task updated.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Add new task
Â  Â  Â  Â  Â  await setDoc(doc(collection(db, "tasks")), { name, description, reward });
Â  Â  Â  Â  Â  alert("Task added.");
Â  Â  Â  Â  }
Â  Â  Â  Â  resetForm();
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  alert("Error saving task: " + error.message);
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
