<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Task Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 text-gray-900">

  <main class="max-w-4xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center">üõ†Ô∏è Admin Task Management</h1>

    <!-- Task Form -->
    <section class="mb-8 bg-white rounded shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Add / Update Task</h2>
      <form id="taskForm" class="space-y-4">
        <input type="hidden" id="taskId" value="" />

        <div>
          <label for="taskName" class="block font-medium mb-1">Task Name <span class="text-red-600">*</span></label>
          <input id="taskName" type="text" required class="w-full border rounded px-3 py-2" placeholder="Enter task name" />
        </div>

        <div>
          <label for="taskDescription" class="block font-medium mb-1">Description</label>
          <textarea id="taskDescription" rows="2" class="w-full border rounded px-3 py-2" placeholder="Enter task description (optional)"></textarea>
        </div>

        <div>
          <label for="taskReward" class="block font-medium mb-1">Reward (‡ß≥) <span class="text-red-600">*</span></label>
          <input id="taskReward" type="number" min="0" step="0.01" required class="w-full border rounded px-3 py-2" placeholder="e.g. 5" />
        </div>

        <div>
          <label for="taskLink" class="block font-medium mb-1">Link (URL) <span class="text-red-600">*</span></label>
          <input id="taskLink" type="url" required class="w-full border rounded px-3 py-2" placeholder="https://example.com" />
        </div>

        <div class="flex gap-4">
          <button type="submit" class="bg-indigo-600 text-white px-5 py-2 rounded hover:bg-indigo-700 font-semibold">
            Save Task
          </button>
          <button type="button" id="clearFormBtn" class="bg-gray-400 text-gray-900 px-5 py-2 rounded hover:bg-gray-500 font-semibold">
            Clear Form
          </button>
        </div>
      </form>
    </section>

    <!-- Task List -->
    <section class="bg-white rounded shadow p-6">
      <h2 class="text-xl font-semibold mb-4">All Tasks</h2>
      <div id="tasksList" class="space-y-4">
        <p>Loading tasks...</p>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      doc,
      getDocs,
      deleteDoc,
      updateDoc,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Your Firebase config here (replace with yours)
    const firebaseConfig = {
      apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
      authDomain: "bdwork-346d3.firebaseapp.com",
      projectId: "bdwork-346d3",
      storageBucket: "bdwork-346d3.appspot.com",
      messagingSenderId: "900963179093",
      appId: "1:900963179093:web:81e42d67bb31d603cc92dc",
      measurementId: "G-FM1YJ8E5GK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const taskForm = document.getElementById("taskForm");
    const taskIdInput = document.getElementById("taskId");
    const taskNameInput = document.getElementById("taskName");
    const taskDescriptionInput = document.getElementById("taskDescription");
    const taskRewardInput = document.getElementById("taskReward");
    const taskLinkInput = document.getElementById("taskLink");
    const clearFormBtn = document.getElementById("clearFormBtn");
    const tasksList = document.getElementById("tasksList");

    // Load and listen to tasks changes realtime
    function listenTasks() {
      const tasksCol = collection(db, "tasks");

      onSnapshot(tasksCol, (snapshot) => {
        tasksList.innerHTML = "";
        if (snapshot.empty) {
          tasksList.innerHTML = "<p>No tasks found.</p>";
          return;
        }
        snapshot.forEach(docSnap => {
          const task = { id: docSnap.id, ...docSnap.data() };
          tasksList.appendChild(createTaskElement(task));
        });
      });
    }

    // Create task element in list
    function createTaskElement(task) {
      const div = document.createElement("div");
      div.className = "p-4 border rounded flex flex-col md:flex-row md:justify-between md:items-center gap-4";

      div.innerHTML = `
        <div>
          <p class="font-semibold text-lg">${task.name}</p>
          <p class="text-gray-600">${task.description || ""}</p>
          <p class="text-indigo-600 font-semibold">Reward: ‡ß≥${task.reward.toFixed(2)}</p>
          <p class="text-blue-700 underline break-all">Link: <a href="${task.link}" target="_blank" rel="noopener noreferrer">${task.link}</a></p>
        </div>
      `;

      const btnsDiv = document.createElement("div");
      btnsDiv.className = "flex gap-2";

      const editBtn = document.createElement("button");
      editBtn.className = "bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded font-semibold";
      editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
      editBtn.onclick = () => populateFormForEdit(task);

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-semibold";
      deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
      deleteBtn.onclick = () => deleteTask(task.id);

      btnsDiv.appendChild(editBtn);
      btnsDiv.appendChild(deleteBtn);
      div.appendChild(btnsDiv);

      return div;
    }

    // Populate form for editing a task
    function populateFormForEdit(task) {
      taskIdInput.value = task.id;
      taskNameInput.value = task.name;
      taskDescriptionInput.value = task.description || "";
      taskRewardInput.value = task.reward;
      taskLinkInput.value = task.link;
      taskNameInput.focus();
    }

    // Clear form inputs
    function clearForm() {
      taskIdInput.value = "";
      taskNameInput.value = "";
      taskDescriptionInput.value = "";
      taskRewardInput.value = "";
      taskLinkInput.value = "";
      taskNameInput.focus();
    }

    // Add or update task on form submit
    taskForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = taskIdInput.value.trim();
      const name = taskNameInput.value.trim();
      const description = taskDescriptionInput.value.trim();
      const reward = parseFloat(taskRewardInput.value);
      const link = taskLinkInput.value.trim();

      if (!name || isNaN(reward) || reward < 0 || !link) {
        alert("Please fill all required fields with valid values.");
        return;
      }

      try {
        if (id) {
          // Update existing task
          const taskDocRef = doc(db, "tasks", id);
          await updateDoc(taskDocRef, {
            name,
            description,
            reward,
            link
          });
          alert("Task updated successfully.");
        } else {
          // Add new task
          const tasksCol = collection(db, "tasks");
          await addDoc(tasksCol, {
            name,
            description,
            reward,
            link
          });
          alert("Task added successfully.");
        }
        clearForm();
      } catch (err) {
        alert("Error: " + err.message);
      }
    });

    // Delete task
    async function deleteTask(taskId) {
      if (!confirm("Are you sure you want to delete this task?")) return;
      try {
        await deleteDoc(doc(db, "tasks", taskId));
        alert("Task deleted.");
      } catch (err) {
        alert("Error deleting task: " + err.message);
      }
    }

    clearFormBtn.addEventListener("click", clearForm);

    // Initialize task list listener
    listenTasks();
  </script>
</body>
</html>
