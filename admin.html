<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js" type="module"></script>
</head>
<body class="bg-gray-100 p-6">

  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6">Admin Panel - Withdraw Requests</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Pending Requests -->
      <div class="bg-white shadow p-4 rounded">
        <h2 class="text-xl font-semibold mb-3">Pending</h2>
        <div id="pendingList" class="space-y-3 text-sm"></div>
      </div>

      <!-- Approved Requests -->
      <div class="bg-green-50 shadow p-4 rounded">
        <h2 class="text-xl font-semibold mb-3">Approved</h2>
        <div id="approvedList" class="space-y-3 text-sm"></div>
      </div>

      <!-- Rejected Requests -->
      <div class="bg-red-50 shadow p-4 rounded">
        <h2 class="text-xl font-semibold mb-3">Rejected</h2>
        <div id="rejectedList" class="space-y-3 text-sm"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs, updateDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
      authDomain: "bdwork-346d3.firebaseapp.com",
      projectId: "bdwork-346d3",
      storageBucket: "bdwork-346d3.appspot.com",
      messagingSenderId: "900963179093",
      appId: "1:900963179093:web:81e42d67bb31d603cc92dc",
      measurementId: "G-FM1YJ8E5GK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statuses = ["pending", "approved", "rejected"];

    async function loadWithdrawRequests() {
      for (const status of statuses) {
        const listElement = document.getElementById(status + "List");
        listElement.innerHTML = "";

        const q = query(collection(db, "withdraws"), where("status", "==", status));
        const snapshot = await getDocs(q);

        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          const div = document.createElement("div");
          div.className = "bg-white p-3 rounded border";
          div.innerHTML = `
            <p><strong>User:</strong> ${data.userId}</p>
            <p><strong>Amount:</strong> à§³${data.amount}</p>
            <p><strong>Time:</strong> ${new Date(data.timestamp?.seconds * 1000).toLocaleString()}</p>
            ${status === "pending" ? `
              <div class="flex gap-2 mt-2">
                <button class="bg-green-600 text-white px-2 py-1 rounded text-sm" onclick="updateStatus('${docSnap.id}', 'approved')">Approve</button>
                <button class="bg-red-600 text-white px-2 py-1 rounded text-sm" onclick="updateStatus('${docSnap.id}', 'rejected')">Reject</button>
              </div>
            ` : ""}
          `;
          listElement.appendChild(div);
        });
      }
    }

    window.updateStatus = async function (docId, newStatus) {
      const ref = doc(db, "withdraws", docId);
      await updateDoc(ref, { status: newStatus });
      alert(`Withdraw ${newStatus}`);
      loadWithdrawRequests();
    };

    loadWithdrawRequests();
  </script>
</body>
</html>
